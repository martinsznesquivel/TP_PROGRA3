<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="css/styles.css" />
        <script src="js/main.js" defer></script>
        <title>Simulacro</title>
    </head>

    <body>
    <header>
        <nav class="nav-principal">
            <span class="titulo">Musical shop</span>
            <div>
                <span id="nombreAlumno"></span>
                <input id="barraBusqueda" type="text", placeholder="Buscar...">
            </div>
            <span id="contadorCarrito">Carrito: 0 productos</span>
        </nav>
        <nav class="nav-secundario">
        <ul>
            <a href="index.html">
                <li>Ver</li>
            </a>
            <a href="consultar.html">
                <li>Consultar ID</li>
            </a>
            <a href="crear.html">
                <li>Crear</li>
            </a>
            <a href="modificar.html">
                <li>Modificar</li>
            </a>
            <a href="eliminar.html">
                <li>Eliminar</li>
            </a>
        </ul>
    </nav>
    </header>

    <main>
        <h1>Consultar Producto por id:</h1>

        <form id="getProducts-form" class="products-form">
            <label for="idProd">Id del Producto</label>
            <input type="number" name="id" id="idProd" required>
            <input type="submit" value="Consultar producto">
        </form>
        <hr>

        <div id="contenedor-productos">
            <ul id="listado-productos"></ul>
        </div>
    </main> 
        
        <script>
        let getProducts_form = document.getElementById("getProducts-form");
        let listado_productos = document.getElementById("listado-productos");

        getProducts_form.addEventListener("submit", async event => {
            event.preventDefault();

            let formData = new FormData(event.target);
            let data = Object.fromEntries(formData.entries());
            let idProducto = data.id;

            try {
                let respuesta = await fetch(`http://localhost:3000/api/productos/${idProducto}`);
                let datos = await respuesta.json();

                let producto = datos.payload[0];
                mostrarProducto(producto);

            } catch (error) {
                console.log("ERROR");
                console.log(error);
            }
        });
        function mostrarProducto(producto){
            console.table(producto);
            let htmlProducto = `
                <li class="li-listados">
                    <h4>${producto.nombre}</h4>
                    <p>${producto.id}</p>
                        <p><strong>Precio:</strong> $${producto.precio}</p>
                        <p><strong>Stock:</strong> ${producto.tipo} unidades</p>
                </li>
                <li class="li-botonera">
                    <input type="button" id="deleteProduct_button" value="eliminar">
                </li>
                `;
                

            listado_productos.innerHTML = htmlProducto;
            // let deleteProduct_button =  document.getElementById("deleteProduct_button");
            // deleteProduct_button.addEventListener("click",event=>{
            //     event.stopPropagation();
            //     let confirmacion = confirm("Desear eliminar producto");
            //     if(!confirmacion){
            //         alert("Eliminacion cancelada");
            //     }
            //     else{
            //         eliminarProducto(producto.id)
            //     }
            // })

        }
        // async function eliminarProducto(id){
        //     try{
        //         let response = await fetch(`http://localhost:3000/api/productos/${id}`,{
        //             method:"DELETE",
        //         });
        //         console.log(response)
        //         let result = await response.json();
        //         if(response.ok){
        //             alert(result.message);
        //             console.log(result.message);
        //             listado_productos.innerHTML = "";
        //         }
        //         else{
        //             alert("No se pudo eliminar un producto");
        //             console.error(result.message)
        //         }
        //     }
        //     //errores de conexion real
        //     catch(error){
        //         console.error("Error en la solicitud DELETE:", error);
        //         alert("Ocurrio un error");
        //     }
        // }
    
    
        </script>
    </body>
</html>