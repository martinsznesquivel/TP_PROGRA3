<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/styles.css" />
    <script src="js/main.js" defer></script>
    <title>Simulacro</title>
  </head>
  <body>

    <header>
        <nav class="nav-principal">
            <span class="titulo">Musical shop</span>
            <div>
                <span id="nombreAlumno"></span>
                <input id="barraBusqueda" type="text", placeholder="Buscar...">
            </div>
            <span id="contadorCarrito">Carrito: 0 productos</span>
        </nav>

        <nav class="nav-secundario">
          <ul>
            <a href="index.html">
              <li>Ver</li>
            </a>
            <a href="consultar.html">
              <li>Consultar ID</li>
            </a>
            <a href="crear.html">
              <li>Crear</li>
            </a>
            <a href="modificar.html">
              <li>Modificar</li>
            </a>
            <a href="eliminar.html">
              <li>Eliminar</li>
            </a>
          </ul>
        </nav>
    </header>

    <main>
        <h1>Crear nuevo producto</h1>

        <form id="altaProducts-form" class="products-form-amplio">
     
            <label for="nombreProd">Nombre</label>
            <input type="text" name="nombre" id="nombreProd" required>
            <br>

            <label for="imagenProd">Imagen</label>
            <input type="text" name="imagen" id="imagenProd" required>
            <br>
            
            <label for="categoriaProd">Categoria</label>
            <select name="categoria" id="categoriaProd" required>
                <option value="CD">CD</option>
                <option value="VINILO">VINILO</option>
                <option value="CASSETTE">CASSETTE</option>
            </select>
            <br>
            
            <label for="precioProd">Precio</label>
            <input type="number" name="precio" id="precioProd" required>
            <br>

            <input type="submit" value="Crear producto">
        </form>

        <hr>
        <div id="contenedor-productos"></div>
    </main>
    
    <script>

        const altaProductsForm = document.getElementById("altaProducts-form");
        const url = "http://localhost:3000/productos";

        altaProductsForm.addEventListener("submit", async (event) => {

        event.preventDefault(); // Evitamos que el formulario se envie por defecto

        // Guardamos en una variable formData los datos del formulario
        let formData = new FormData(event.target);
    
        // creamos un objeto JS con los datos del objeto FormData
        let data = Object.fromEntries(formData.entries());
    
        // Con el nuevo objeto JS creado usando los valores de los formularios, lo enviamos al servidor en un formato JSON
        
        enviarProducto(data);

        async function enviarProducto(data) {
        
            console.table(data);
        
            try {
                let response = await fetch(url, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(data)
                }); 
                
                let result = await response.json();

                if (response.ok) {
                    console.log(result.message);
                    alert(`Producto creado con exito con id: ${result.productId}`);
                    event.target.reset();
                } else {
                    alert(`Error en la creacion de producto: ${result.message}`);
                }

            } catch(error) {
                console.error("Error al enviar los datos: ", error);
                alert("Error al procesar la solicitud");
            }
         }
    });
    </script>
  </body>
</html>
